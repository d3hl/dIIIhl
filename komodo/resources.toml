[[server]]
name = "k-120"
[server.config]
address = "https://10.203.1.120:8120"
region = "CL"
enabled = true
passkey = "yt0u6axd1rNY7EO13254WF9J38683gBe"

##

[[server]]
name = "k-121"
[server.config]
address = "https://10.203.1.120:8120"
region = "CL"
enabled = true

##

[[server]]
name = "komodo1"
[server.config]
address = "https://host.docker.internal:8120"
region = "HL"
enabled = true

##

[[server]]
name = "komodo2"
[server.config]
address = "https://10.10.10.31:8120"
region = "HL"
enabled = true
passkey = "i4FnpPizwNFTpw7yc5HeAX8wFm5w9eXB"

##

[[server]]
name = "komodo3"
[server.config]
address = "https://10.10.10.32:8120"
region = "HL"
enabled = true
passkey = "22ajbb6BApjQZFf04wAbGe55MwMl5dkL"

##

[[server]]
name = "pangolin"
[server.config]
address = "https://45.127.32.141:8120"
enabled = true

##

[[stack]]
name = "authentik"
tags = ["core", "external"]
[stack.config]
server = "komodo1"
links = ["https://auth.d3adc3ii.cc"]
poll_for_updates = true
auto_update = true
auto_update_all_services = true
file_contents = """
services:
  postgresql:
    env_file:
    - .env
    environment:
      POSTGRES_DB: ${PG_DB:-authentik}
      POSTGRES_PASSWORD: ${PG_PASS:?database password required}
      POSTGRES_USER: ${PG_USER:-authentik}
    healthcheck:
      interval: 30s
      retries: 5
      start_period: 20s
      test:
      - CMD-SHELL
      - pg_isready -d $${POSTGRES_DB} -U $${POSTGRES_USER}
      timeout: 5s
    image: docker.io/library/postgres:16-alpine
    restart: unless-stopped
    volumes:
    - database:/var/lib/postgresql/data
  redis:
    command: --save 60 1 --loglevel warning
    healthcheck:
      interval: 30s
      retries: 5
      start_period: 20s
      test:
      - CMD-SHELL
      - redis-cli ping | grep PONG
      timeout: 3s
    image: docker.io/library/redis:alpine
    restart: unless-stopped
    volumes:
    - redis:/data
  server:
    command: server
    depends_on:
      postgresql:
        condition: service_healthy
      redis:
        condition: service_healthy
    env_file:
    - .env
    environment:
      AUTHENTIK_POSTGRESQL__HOST: postgresql
      AUTHENTIK_POSTGRESQL__NAME: ${PG_DB:-authentik}
      AUTHENTIK_POSTGRESQL__PASSWORD: ${PG_PASS}
      AUTHENTIK_POSTGRESQL__USER: ${PG_USER:-authentik}
      AUTHENTIK_REDIS__HOST: redis
      AUTHENTIK_SECRET_KEY: ${AUTHENTIK_SECRET_KEY:?secret key required}
    image: ${AUTHENTIK_IMAGE:-ghcr.io/goauthentik/server}:${AUTHENTIK_TAG:-2025.8.0}
    ports:
    - ${COMPOSE_PORT_HTTP:-9000}:9000
    - ${COMPOSE_PORT_HTTPS:-9443}:9443
    restart: unless-stopped
    volumes:
    - ./media:/media
    - ./custom-templates:/templates
  worker:
    command: worker
    depends_on:
      postgresql:
        condition: service_healthy
      redis:
        condition: service_healthy
    env_file:
    - .env
    environment:
      AUTHENTIK_POSTGRESQL__HOST: postgresql
      AUTHENTIK_POSTGRESQL__NAME: ${PG_DB:-authentik}
      AUTHENTIK_POSTGRESQL__PASSWORD: ${PG_PASS}
      AUTHENTIK_POSTGRESQL__USER: ${PG_USER:-authentik}
      AUTHENTIK_REDIS__HOST: redis
      AUTHENTIK_SECRET_KEY: ${AUTHENTIK_SECRET_KEY:?secret key required}
    image: ${AUTHENTIK_IMAGE:-ghcr.io/goauthentik/server}:${AUTHENTIK_TAG:-2025.8.0}
    restart: unless-stopped
    user: root
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock
    - ./media:/media
    - ./certs:/certs
    - ./custom-templates:/templates
  authentik_proxy:
    image: ghcr.io/goauthentik/proxy:2025.8.0
        # Optionally specify the container's network, which must be able to reach the core authentik server.
        # networks:
        #   - foo
    ports:
      - 9000:9000
      - 9443:9443
    environment:
      AUTHENTIK_HOST: http://10.10.10.70:8175
      AUTHENTIK_INSECURE: "true"
      AUTHENTIK_TOKEN: QAk1Uxn4iwSd1tiAEmDAVMTvgu46hyy3er847Rksh5yjUY1kZN4cigNyG1mn
            # Optional setting to be used when `authentik_host` for internal communication doesn't match the public URL.
      AUTHENTIK_HOST_BROWSER: https://auth.d3adc3ii.cc
volumes:
  database:
    driver: local
  redis:
    driver: local
"""
environment = """
PG_PASS=[[AUTHENTIK_PG_PASS]]
AUTHENTIK_SECRET_KEY= [[AUTHENTIK_SECRET_KEY]]
# SMTP Host Emails are sent to
AUTHENTIK_EMAIL__HOST= mail.smtp2go.com
AUTHENTIK_EMAIL__PORT=8025 
# Optionally authenticate (don't add quotation marks to your password)
AUTHENTIK_EMAIL__USERNAME=d3adc3ii.cc
AUTHENTIK_EMAIL__PASSWORD=taolavodich1234
# Use StartTLS
AUTHENTIK_EMAIL__USE_TLS=true
# Use SSL
AUTHENTIK_EMAIL__USE_SSL=false
AUTHENTIK_EMAIL__TIMEOUT=10
# Email address authentik will send from, should have a correct @domain
AUTHENTIK_EMAIL__FROM=d3tech@pm.me

COMPOSE_PORT_HTTP=8175
COMPOSE_PORT_HTTPS=6443
"""

##

[[stack]]
name = "beszel"
tags = [
  "komodo-1",
  "external",
  "monitoring",
  "beszel"
]
[stack.config]
server = "komodo2"
links = ["https://beszel.d3adc3ii.cc"]
project_name = "beszel"
poll_for_updates = true
auto_update = true
auto_update_all_services = true
file_contents = """
services:
  beszel:
    image: henrygd/beszel:latest
    container_name: beszel
    restart: unless-stopped
    env_file:
      - .env
    ports:
      - 8090:8090
    volumes:
      - ${CDATA}/beszel/data:/beszel_data
      - ${CDATA}/beszel/socket:/beszel_socket
  beszel-agent:
    image: henrygd/beszel-agent:latest
    container_name: beszel-agent
    restart: unless-stopped
    network_mode: host
    volumes:
      - ${CDATA}/beszel/socket:/beszel_socket
      - /var/run/docker.sock:/var/run/docker.sock:ro
    env_file:
      - .env
    environment:
      LISTEN: /beszel_socket/beszel.sock
      # Do not remove quotes around the key
"""
environment = """
PGID=1000
PUID=1000
USER_CREATION=true
KEY: 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIG+PtfmPHdKiaE+gbET/6wZeFSnsUEgOXpKM1qJ4gCPp'
"""

##

[[stack]]
name = "blocky"
tags = ["komodo1"]
[stack.config]
server = "komodo1"
project_name = "blocky"
poll_for_updates = true
auto_update = true
auto_update_all_services = true
file_contents = """
services:
  blocky:
    image: ghcr.io/0xerr0r/blocky
    container_name: blocky
    restart: unless-stopped
    # Optional the instance hostname for logging purpose
    hostname: blocky-hostname
    ports:
      - "53:53/tcp"
      - "53:53/udp"
      - "853:853/udp"
      - "853:853/tcp"
      - "4000:4000/tcp"
    environment:
      - PGID=1000
      - PUID=1000
      - TZ=Asia/Singapore # Optional to synchronize the log timestamp with host
      - CDATA=/mnt/cephfs/appdata
    volumes:
      # Optional to synchronize the log timestamp with host
      - /etc/localtime:/etc/localtime:ro
      # config file
      - ${CDATA}/blocky/config.yml:/app/config.yml:ro
      - ${ZDATA}/blocky/logs:/logs
      - ${ZDATA}/blocky/denylists:/app/denylists/
      - ${ZDATA}/blocky/allowlists:/app/allowlists/
"""
environment = """
CDATA=/mnt/cephfs/appdata
"""

##

[[stack]]
name = "bookstack"
tags = ["komodo2", "external"]
[stack.config]
server = "komodo2"
links = [
  "https://bookstack.d3adc3ii.cc"
]
auto_update = true
auto_update_all_services = true
file_contents = """
services:
  bookstack:
    image: lscr.io/linuxserver/bookstack:latest
    container_name: bookstack
    env_file:
      - .env
    environment:
      - PUID=1000
      - PGID=1000
      - DB_PORT=3306
      - APP_THEME=custom
    volumes:
      - ${DOCKER_DATA}/bookstack/config:/config
    ports:
      - 6875:80
    restart: unless-stopped
    labels:
      - homepage.group=Applications
      - homepage.name=bookstack
      - homepage.icon=sh-bookstack-light
      - homepage.href=https://bookstack.d3adc3ii.cc/
  mariadb:
    image: lscr.io/linuxserver/mariadb:latest
    container_name: mariadb
    env_file:
      - .env
    environment:
      - PUID=1000
      - PGID=1000
    volumes:
      - ${DOCKER_DATA}/bookstack/mariadb/config:/config
    ports:
      - 3306:3306
    restart: unless-stopped
"""
environment = """
TZ=Asia/Singapore
QUEUE_CONNECTION=database
DB_DATABASE=bookstackdb
DB_HOST=mariadb
DB_USERNAME=d3
DB_PASSWORD=USCLZHFZZuT7NFAPVo84bdGTRsDB7v7A
MYSQL_PASSWORD=USCLZHFZZuT7NFAPVo84bdGTRsDB7v7A
APP_URL=https://bookstack.d3adc3ii.cc
APP_KEY=base64:5hfLcDEkhQzRlsTu5xLg7+1xRH4PH9QKacJY65gDQpU=
MYSQL_DATABASE=bookstackdb
MYSQL_USER=d3
MYSQL_ROOT_PASSWORD=USCLZHFZZuT7NFAPVo84bdGTRsDB7v7A123
MYSQL_PASSWORD=USCLZHFZZuT7NFAPVo84bdGTRsDB7v7A
"""

##

[[stack]]
name = "godoxy"
tags = ["internal", "core", "proxy"]
[stack.config]
server = "komodo1"
links = ["https://doxy.d3adc3ii.site/"]
project_name = "godoxy"
poll_for_updates = true
auto_update = true
auto_update_all_services = true
file_contents = """
services:
  socket-proxy:
    container_name: socket-proxy
    image: ghcr.io/yusing/socket-proxy:latest
    environment:
      - ALLOW_START=1
      - ALLOW_STOP=1
      - ALLOW_RESTARTS=1
      - CONTAINERS=1
      - EVENTS=1
      - INFO=1
      - PING=1
      - POST=1
      - VERSION=1
    volumes:
      - ${DOCKER_SOCKET:-/var/run/docker.sock}:/var/run/docker.sock
    restart: unless-stopped
    tmpfs:
      - /run
    ports:
      - ${SOCKET_PROXY_LISTEN_ADDR:-127.0.0.1:2375}:2375
  frontend:
    image: ghcr.io/yusing/godoxy-frontend:${TAG:-latest}
    container_name: godoxy-frontend
    restart: unless-stopped
    network_mode: host
    env_file: .env
    user: 1000:1000
    read_only: true
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - all
    depends_on:
      - app
    environment:
      HOSTNAME: 127.0.0.1
      PORT: ${GODOXY_FRONTEND_PORT}
    labels:
      proxy.aliases: ${GODOXY_FRONTEND_ALIASES}
      proxy.doxy.port: ${GODOXY_FRONTEND_PORT}
     # proxy.doxy.middlewares.oidc:
      # proxy.#1.middlewares.cidr_whitelist: |
      #   status: 403
      #   message: IP not allowed
      #   allow:
      #     - 127.0.0.1
      #     - 10.0.0.0/8
      #     - 192.168.0.0/16
      #     - 172.16.0.0/12
  app:
    image: ghcr.io/yusing/godoxy:${TAG:-latest}
    container_name: godoxy-proxy
    restart: always
    network_mode: host # do not change this
    #extra_hosts:
    #  - auth.d3adc3ii.cc:127.0.0.1
    dns:
      - 1.1.1.1
      - 1.1.1.2
    environment:
      - CF_API_TOKEN= ${CF_API_TOKEN}
      - CF_EMAIL= ${CF_EMAIL}
      - DOCKER_HOST=tcp://${SOCKET_PROXY_LISTEN_ADDR:-127.0.0.1:2375}
    env_file: .env
    user: 1000:1000
    depends_on:
      socket-proxy:
        condition: service_started
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - all
    cap_add:
      - NET_BIND_SERVICE
    volumes:
      - ${DOCKER_DATA}/godoxy/config:/app/config
      - ${DOCKER_DATA}/godoxy/logs:/app/logs
      - ${DOCKER_DATA}/godoxy/error_pages:/app/error_pages:ro
      - ${DOCKER_DATA}/godoxy/data:/app/data
      - ${DOCKER_DATA}/godoxy/certs:/app/certs

      # remove "./certs:/app/certs" and uncomment below to use existing certificate
      # - /path/to/certs/cert.crt:/app/certs/cert.crt
      # - /path/to/certs/priv.key:/app/certs/priv.key
"""
environment = """
COMPOSE_PROJECT_NAME= godoxy
TAG=latest
TZ=Asia/Singapore
PUID=1000
PGID=1000
GODOXY_EMAIL= d3tech@pm.me
CONFIG_DIR=/etc/komodo/repos/Public-70/komodo/resources/godoxy/config
CF_API_TOKEN= [[CF_API_TOKEN]]
CF_EMAIL= d3tech@pm.me
# API JWT Configuration (common)
# generate secret with `openssl rand -base64 32`
GODOXY_API_JWT_SECRET=4m64Gth6C6VZeLHxGOQzVe3Myigx5gqHm4KqN5HxwM8=
# the JWT token time-to-live
# leave empty to use default (24 hours)
# format: https://pkg.go.dev/time#Duration
GODOXY_API_JWT_TOKEN_TTL=

# API/WebUI user password login credentials (optional)
# These fields are not required for OIDC authentication
GODOXY_API_USER=d3
GODOXY_API_PASSWORD=qyp.kmr2ktf5vcj3CYM

# OIDC Configuration (optional)
# Uncomment and configure these values to enable OIDC authentication.
#

#GODOXY_OIDC_ISSUER_URL=https://auth.d3adc3ii.cc/application/o/godoxy/    
#GODOXY_OIDC_ISSUER_URL=http://10.10.10.7:8175/application/o/godoxy/                       
#GODOXY_OIDC_CLIENT_ID=xk2q92Kot1vBSHe4m6vDvNJBE23qSVhRtFytnmGU
#GODOXY_OIDC_CLIENT_SECRET=Cb4wJ4InYSh3MyDkEqpFcHVHfyupQnDkmOkpBxN5oDh3EakcPq42MMkSWI1N6i0mD6snMs9Pw0YIRHlXYeVwUsCrhuVNzYz3Avj7IfqtFCFIZupCgXa2iSlfOLRd84bQ
#GODOXY_OIDC_SCOPES=openid, profile, email, groups
#GODOXY_OIDC_ALLOWED_USERS=d3
# User definitions: Uncomment and configure these values to restrict access to specific users or groups.
# These two fields act as a logical AND operator. For example, given the following membership:
#   user1, group1
#   user2, group1
#   user3, group2
#   user1, group2
# You can allow access to user3 AND all users of group1 by providing:
#   # GODOXY_OIDC_ALLOWED_USERS=user3
#GODOXY_OIDC_ALLOWED_GROUPS=	"authentik Admins"
#
# Comma-separated list of allowed users.
# GODOXY_OIDC_ALLOWED_USERS=user1,user2
# Optional: Comma-separated list of allowed groups.
# GODOXY_OIDC_ALLOWED_GROUPS=group1,group2

# Proxy listening address
GODOXY_HTTP_ADDR=10.10.10.70:80
GODOXY_HTTPS_ADDR=:443

# Enable HTTP3
GODOXY_HTTP3_ENABLED=true

# API listening address
GODOXY_API_ADDR=127.0.0.1:8888

# Metrics
GODOXY_METRICS_DISABLE_CPU=false
GODOXY_METRICS_DISABLE_MEMORY=false
GODOXY_METRICS_DISABLE_DISK=false
GODOXY_METRICS_DISABLE_NETWORK=false
GODOXY_METRICS_DISABLE_SENSORS=false

# Frontend listening port
GODOXY_FRONTEND_PORT=3716

# Frontend aliases (subdomains / FQDNs, e.g. godoxy, godoxy.domain.com)
GODOXY_FRONTEND_ALIASES=doxy

# Docker socket
# /var/run/podman/podman.sock for podman
DOCKER_SOCKET=/var/run/docker.sock
SOCKET_PROXY_LISTEN_ADDR=127.0.0.1:2375

# Debug mode
GODOXY_DEBUG=true
"""

##


##

[[stack]]
name = "newt"
tags = ["komodo3"]
[stack.config]
server = "komodo3"
poll_for_updates = true
auto_update = true
auto_update_all_services = true
file_contents = """
services:
  newt:
    image: fosrl/newt
    container_name: newt
    restart: unless-stopped
    environment:
      - PANGOLIN_ENDPOINT=https://pangolin.d3adc3ii.cc
      - NEWT_ID=jazianb9pxf8f2k
      - NEWT_SECRET=vmfug29a5uhz7lm313x838k28rtu585xaf31y8jw7j70nejs
"""
<<<<<<< HEAD
##


[[stack]]
name = "godoxy"
tags = [
  "internal",
  "core",
  "proxy",
]
[stack.config]
server = "komodo1"
links = ["https://doxy.d3adc3ii.site/"]
project_name = "godoxy"
poll_for_updates = true
auto_update = true
auto_update_all_services = true
file_contents = """
services:
  socket-proxy:
    container_name: socket-proxy
    image: ghcr.io/yusing/socket-proxy:latest
    environment:
      - ALLOW_START=1
      - ALLOW_STOP=1
      - ALLOW_RESTARTS=1
      - CONTAINERS=1
      - EVENTS=1
      - INFO=1
      - PING=1
      - POST=1
      - VERSION=1
    volumes:
      - ${DOCKER_SOCKET:-/var/run/docker.sock}:/var/run/docker.sock
    restart: unless-stopped
    tmpfs:
      - /run
    ports:
      - ${SOCKET_PROXY_LISTEN_ADDR:-127.0.0.1:2375}:2375
  frontend:
    image: ghcr.io/yusing/godoxy-frontend:${TAG:-latest}
    container_name: godoxy-frontend
    restart: unless-stopped
    network_mode: host
    env_file: .env
    user: 1000:1000
    read_only: true
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - all
    depends_on:
      - app
    environment:
      HOSTNAME: 127.0.0.1
      PORT: ${GODOXY_FRONTEND_PORT}
    labels:
      proxy.aliases: ${GODOXY_FRONTEND_ALIASES}
      proxy.doxy.port: ${GODOXY_FRONTEND_PORT}
     # proxy.doxy.middlewares.oidc:
      # proxy.#1.middlewares.cidr_whitelist: |
      #   status: 403
      #   message: IP not allowed
      #   allow:
      #     - 127.0.0.1
      #     - 10.0.0.0/8
      #     - 192.168.0.0/16
      #     - 172.16.0.0/12
  app:
    image: ghcr.io/yusing/godoxy:${TAG:-latest}
    container_name: godoxy-proxy
    restart: always
    network_mode: host # do not change this
    #extra_hosts:
    #  - auth.d3adc3ii.cc:127.0.0.1
    dns:
      - 1.1.1.1
      - 1.1.1.2
    environment:
      - CF_API_TOKEN= ${CF_API_TOKEN}
      - CF_EMAIL= ${CF_EMAIL}
      - DOCKER_HOST=tcp://${SOCKET_PROXY_LISTEN_ADDR:-127.0.0.1:2375}
    env_file: .env
    user: 1000:1000
    depends_on:
      socket-proxy:
        condition: service_started
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - all
    cap_add:
      - NET_BIND_SERVICE
    volumes:
      - ${DOCKER_DATA}/godoxy/config:/app/config
      - ${DOCKER_DATA}/godoxy/logs:/app/logs
      - ${DOCKER_DATA}/godoxy/error_pages:/app/error_pages:ro
      - ${DOCKER_DATA}/godoxy/data:/app/data
      - ${DOCKER_DATA}/godoxy/certs:/app/certs

      # remove "./certs:/app/certs" and uncomment below to use existing certificate
      # - /path/to/certs/cert.crt:/app/certs/cert.crt
      # - /path/to/certs/priv.key:/app/certs/priv.key
"""
environment = """
COMPOSE_PROJECT_NAME= godoxy
TAG=latest
TZ=Asia/Singapore
PUID=1000
PGID=1000
GODOXY_EMAIL= d3tech@pm.me
CONFIG_DIR=/etc/komodo/repos/Public-70/komodo/resources/godoxy/config
CF_API_TOKEN= [[CF_API_TOKEN]]
CF_EMAIL= d3tech@pm.me
# API JWT Configuration (common)
# generate secret with `openssl rand -base64 32`
GODOXY_API_JWT_SECRET=4m64Gth6C6VZeLHxGOQzVe3Myigx5gqHm4KqN5HxwM8=
# the JWT token time-to-live
# leave empty to use default (24 hours)
# format: https://pkg.go.dev/time#Duration
GODOXY_API_JWT_TOKEN_TTL=

# API/WebUI user password login credentials (optional)
# These fields are not required for OIDC authentication
GODOXY_API_USER=d3
GODOXY_API_PASSWORD=qyp.kmr2ktf5vcj3CYM

# OIDC Configuration (optional)
# Uncomment and configure these values to enable OIDC authentication.
#

#GODOXY_OIDC_ISSUER_URL=https://auth.d3adc3ii.cc/application/o/godoxy/    
#GODOXY_OIDC_ISSUER_URL=http://10.10.10.7:8175/application/o/godoxy/                       
#GODOXY_OIDC_CLIENT_ID=xk2q92Kot1vBSHe4m6vDvNJBE23qSVhRtFytnmGU
#GODOXY_OIDC_CLIENT_SECRET=Cb4wJ4InYSh3MyDkEqpFcHVHfyupQnDkmOkpBxN5oDh3EakcPq42MMkSWI1N6i0mD6snMs9Pw0YIRHlXYeVwUsCrhuVNzYz3Avj7IfqtFCFIZupCgXa2iSlfOLRd84bQ
#GODOXY_OIDC_SCOPES=openid, profile, email, groups
#GODOXY_OIDC_ALLOWED_USERS=d3
# User definitions: Uncomment and configure these values to restrict access to specific users or groups.
# These two fields act as a logical AND operator. For example, given the following membership:
#   user1, group1
#   user2, group1
#   user3, group2
#   user1, group2
# You can allow access to user3 AND all users of group1 by providing:
#   # GODOXY_OIDC_ALLOWED_USERS=user3
#GODOXY_OIDC_ALLOWED_GROUPS=	"authentik Admins"
#
# Comma-separated list of allowed users.
# GODOXY_OIDC_ALLOWED_USERS=user1,user2
# Optional: Comma-separated list of allowed groups.
# GODOXY_OIDC_ALLOWED_GROUPS=group1,group2

# Proxy listening address
GODOXY_HTTP_ADDR=10.10.10.70:80
GODOXY_HTTPS_ADDR=:443

# Enable HTTP3
GODOXY_HTTP3_ENABLED=true

# API listening address
GODOXY_API_ADDR=127.0.0.1:8888

# Metrics
GODOXY_METRICS_DISABLE_CPU=false
GODOXY_METRICS_DISABLE_MEMORY=false
GODOXY_METRICS_DISABLE_DISK=false
GODOXY_METRICS_DISABLE_NETWORK=false
GODOXY_METRICS_DISABLE_SENSORS=false

# Frontend listening port
GODOXY_FRONTEND_PORT=3716

# Frontend aliases (subdomains / FQDNs, e.g. godoxy, godoxy.domain.com)
GODOXY_FRONTEND_ALIASES=doxy

# Docker socket
# /var/run/podman/podman.sock for podman
DOCKER_SOCKET=/var/run/docker.sock
SOCKET_PROXY_LISTEN_ADDR=127.0.0.1:2375

# Debug mode
GODOXY_DEBUG=true
"""
##


[[stack]]
name = "dozzle"
tags = [
  "internal",
  "monitoring",
  "komodo-3",
  "docker"
]
[stack.config]
server = "komodo-1"
poll_for_updates = true
auto_update = true
auto_update_all_services = true
file_contents = """
services:
  dozzle:
    image: amir20/dozzle:latest
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - 8787:8080
    env_file:
      - .env
    labels:
      proxy.dozzle.port: 8787
      proxy.dozzle-backend.port: 8080
"""
environment = """
DOZZLE_ENABLE_ACTIONS=true
DOZZLE_ENABLE_SHELL=true
#DOZZLE_AUTH_PROVIDER: forward-proxy
DOZZLE_REMOTE_AGENT=10.10.10.25:7007,10.10.10.26:7007
"""
=======
>>>>>>> f2fcaa305a848a661fb57a7df319d2bcf2558ce9

##

[[stack]]
name = "dumbpad"
tags = ["external", "komodo-2"]
[stack.config]
server = "komodo-2"
poll_for_updates = true
auto_update = true
auto_update_all_services = true
file_contents = """
networks:
  d3internal:
    external: true
services:
  dumbpad:
    image: dumbwareio/dumbpad:latest
    container_name: dumbpad
    restart: unless-stopped
    networks:
      - d3internal
    ports:
      - 3765:3000
    volumes:
      - ${DOCKER_DATA}/dumbpad/data:/app/data
    environment:
      # The title shown in the web interface
      SITE_TITLE: ${DUMBPAD_SITE_TITLE:-DumbPad}
      # Optional PIN protection (leave empty to disable)
      DUMBPAD_PIN: ${DUMBPAD_PIN}
      # The base URL for the application
      BASE_URL: ${DUMBPAD_BASE_URL:-http://localhost:3000} # Use ALLOWED_ORIGINS below to restrict cors to specific origins
      # (OPTIONAL)
      # Usage: Comma-separated list of urls: http://localhost:port,http://internalip:port,https://base.proxy.tld,https://authprovider.domain.tld
      # ALLOWED_ORIGINS: ${DUMBPAD_ALLOWED_ORIGINS:-http://localhost:3000} # Comment out to allow all origins (*)
      # LOCKOUT_TIME: ${DUMBPAD_LOCK_TIME:-15} # Customize pin lockout time (if empty, defaults to 15 in minutes)
      # MAX_ATTEMPTS: ${DUMBPAD_MAX_ATTEMPTS:-5} # Customize pin max attempts (if empty, defaults to 5)
      # COOKIE_MAX_AGE: ${DUMBPAD_COOKIE_MAX_AGE:-24} # Customize maximum age of cookies primarily used for pin verification (default 24) in hours
      # PAGE_HISTORY_COOKIE_AGE: ${DUMBPAD_PAGE_HISTORY_COOKIE_AGE:-365} # Customize age of cookie to show the last notepad opened (default 365 | max 400) in days - shows default notepad on load if expired
      
      # MARKDOWN CODE SYNTAX HIGHLIGHTING (only use below if you want to restrict to specific languages):
      # By default, DumbPad includes support for all ~180 languages supported by highlight.js.
      # view entire list and usage in /docs/MARKDOWN_SYNTAX_HIGHLIGHTING_USAGE.md
      # HIGHLIGHT_LANGUAGES=c,csharp,css,dockerfile,go,html,java,javascript,json,kotlin,markdown,perl,php,python,ruby,sql,swift,typescript,xml,yaml
    labels:
      - homepage.group=Tools
      - homepage.name=Dumbpad
      - homepage.icon=sh-dumbpad-light
      - homepage.href=https://dumbpad.d3adc3ii.cc/
"""
environment = """
DUMBPAD_PIN=210825
"""

##

[[repo]]
name = "dIIIhl"
[repo.config]
git_account = "d3hl"
repo = "d3hl/dIIIhl"

##

[[procedure]]
name = "Backup Core Database"
description = "Triggers the Core database backup at the scheduled time."
tags = ["system"]
config.schedule = "Every day at 01:00"

[[procedure.config.stage]]
name = "Stage 1"
enabled = true
executions = [
  { execution.type = "BackupCoreDatabase", execution.params = {}, enabled = true }
]

##

[[procedure]]
name = "Global Auto Update"
description = "Pulls and auto updates Stacks and Deployments using 'poll_for_updates' or 'auto_update'."
tags = ["system"]
config.schedule = "Every day at 03:00"

[[procedure.config.stage]]
name = "Stage 1"
enabled = true
executions = [
  { execution.type = "GlobalAutoUpdate", execution.params = {}, enabled = true }
]

##

[[builder]]
name = "komodo1"
[builder.config]
type = "Server"
params = {}

##

[[resource_sync]]
name = "sync"
[resource_sync.config]
linked_repo = "dIIIhl"
resource_path = ["komodo/resources.toml"]
managed = true