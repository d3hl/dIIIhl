[[server]]
name = "k-120"
[server.config]
address = "https://10.203.1.120:8120"
region = "CL"
enabled = true
passkey = "yt0u6axd1rNY7EO13254WF9J38683gBe"

##

[[server]]
name = "k-121"
[server.config]
address = "https://10.203.1.120:8120"
region = "CL"
enabled = true

##

[[server]]
name = "komodo1"
[server.config]
address = "https://host.docker.internal:8120"
region = "HL"
enabled = true

##

[[server]]
name = "komodo2"
[server.config]
address = "https://10.10.10.31:8120"
region = "HL"
enabled = true
passkey = "i4FnpPizwNFTpw7yc5HeAX8wFm5w9eXB"

##

[[server]]
name = "komodo3"
[server.config]
address = "https://10.10.10.32:8120"
region = "HL"
enabled = true
passkey = "22ajbb6BApjQZFf04wAbGe55MwMl5dkL"

##

[[server]]
name = "pangolin"
[server.config]
address = "https://45.127.32.141:8120"
enabled = true

##

##

[[stack]]
name = "newt"
tags = ["komodo3"]
[stack.config]
server = "komodo3"
poll_for_updates = true
auto_update = true
auto_update_all_services = true
file_contents = """
services:
  newt:
    image: fosrl/newt
    container_name: newt
    restart: unless-stopped
    environment:
      - PANGOLIN_ENDPOINT=https://pangolin.d3adc3ii.cc
      - NEWT_ID=jazianb9pxf8f2k
      - NEWT_SECRET=vmfug29a5uhz7lm313x838k28rtu585xaf31y8jw7j70nejs
"""

##

[[repo]]
name = "d3hl-dIIIhl"
[repo.config]
server = "komodo1"
git_account = "d3hl"
repo = "d3hl/dIIIhl"
path = "komodo"

##

[[repo]]
name = "dIIIhl"
template = true
[repo.config]
server = "komodo1"
git_account = "d3hl"
repo = "d3hl/dIIIhl"
path = "komodo"

##

[[procedure]]
name = "Backup Core Database"
description = "Triggers the Core database backup at the scheduled time."
tags = ["system"]
config.schedule = "Every day at 01:00"

[[procedure.config.stage]]
name = "Stage 1"
enabled = true
executions = [
  { execution.type = "BackupCoreDatabase", execution.params = {}, enabled = true }
]

##

[[procedure]]
name = "Global Auto Update"
description = "Pulls and auto updates Stacks and Deployments using 'poll_for_updates' or 'auto_update'."
tags = ["system"]
config.schedule = "Every day at 03:00"

[[procedure.config.stage]]
name = "Stage 1"
enabled = true
executions = [
  { execution.type = "GlobalAutoUpdate", execution.params = {}, enabled = true }
]

##

[[builder]]
name = "komodo1"
[builder.config]
type = "Server"
params = {}

##

[[resource_sync]]
name = "sync"
[resource_sync.config]
linked_repo = "d3hl-dIIIhl"
resource_path = [
  "komodo/resources/resources.toml"
]
managed = true